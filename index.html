<!DOCTYPE html>
<html>
<head>
    <meta charset='utf-8' />
    <title>Cali</title>
    <meta name='viewport' content='initial-scale=1,maximum-scale=1,user-scalable=no' />
    
    <script src="../d3.v4.min.js"></script>
    <script src='../mapbox-gl.js'></script>
    <link href='../mapbox-gl.css' rel='stylesheet' />
    
    <style>
       body { margin:0;position:fixed;top:0;right:0;bottom:0;left:0; }
    #map { 
      position:absolute; 
      width: 100%;
      height: 100%;
    }
    svg {
      position: absolute;
      width: 100%;
      height: 100%;
      pointer-events: none;
    }
    </style>
</head>
<body>
    <div id='map'></div>
    <script>
        var map = new mapboxgl.Map({
            container: 'map', // container id
            style: 'https://raw.githubusercontent.com/osm2vectortiles/mapbox-gl-styles/master/styles/bright-v9-cdn.json',
            center: [-76.5099900, 3.4356283], // starting position
            zoom: 13 // starting zoom
        });

	map.addControl(new mapboxgl.Navigation());

    	var container = map.getCanvasContainer();
    	var svg = d3.select(container).append("svg");
        g = svg.append("g");

	d3.json("circles.json", function(collection) {
		/* Add a LatLng object to each item in the dataset */
		collection.objects.forEach(function(d) {
			d.LatLng = new mapboxgl.LngLat(d.circle.coordinates[1], d.circle.coordinates[0]);
		})
		
		var circles = g.selectAll("circle")
			.data(collection.objects)
			.enter().append("circle")
			.style("stroke", "black")  
			.style("opacity", 1) 
			.style("fill", "#00B0FF")
			.attr("r", 8);  
		
		map.on("viewreset", update);
                map.on("move", update)
		update();

		function update() {
			circles.attr("transform", 
				function(d) { 
				   return "translate("+ map.project(d.LatLng).x +","+ map.project(d.LatLng).y +")";
				}
			)
		}

	});

	
    </script>
</body>
</html>

